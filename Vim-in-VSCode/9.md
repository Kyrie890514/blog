---
outline: deep
---

# Command-line mode

Command-line mode(命令行模式)，简单来说，就是让我们执行一些命令的模式。

## 语法

在 Normal mode 下，我们输入 `:`，会发现这是下方状态栏的左边出现了 `:`，并且光标定位到了其后面，可以在状态栏中输入字符，这是就进入了 Command-line mode。

接着我们需要输入相应的命令，比如说对应保存的 `w`。

输入完命令后摁下 `<Enter>`，这是就会执行相应的命令，比如说保存操作，接着就会回到 Normal mode。

同样的，可以使用 `<Esc>`, `<Ctrl-c>` 或是 `<Ctrl-[>` 中途退出 Command-line mode。

我们也可以使用 `<Ctrl-h>`，`<Ctrl-w>` 和 `<Ctrl-u>` 删除字符。

## 常用命令

下面会介绍一些常用的命令。

- `:edit {file path}` 或 `:e {file path}`: 创建一个文件并进入编辑

这里的 {file path} 是一个相对路径，相对于当前的文件位置。

- `:write` 或 `:w`: 保存文件

- `:quit` 或 `:q`: 关闭文件

- `:write!` 或 `:w!`: 强制保存文件

- `:quit!` 或 `:q!`: 强制关闭文件(不保存)

- `:wq`: 保存并关闭文件

`w` 和 `q` 也可以结合 `all` 针对所有文件操作。

- ` :wall` 或 `:wa`: 保存所有文件

- ` :qall` 或 `:qa`: 关闭所有文件

- ` :wall!` 或 `:wa!`: 强制保存所有文件

- ` :qall!` 或 `:qa!`: 强制关闭所有文件(不保存)

- ` :wqall` 或 `:wqa`: 保存并关闭所有文件

在输入 `:` 进入 Command-line mode 后，使用上下键可以快速的查看之前执行过的命令。

## 多行操作

命令行模式提供了一种方便同时操作多行的方法，其语法为：

- `:{range}{command}{options}`

其中，{range}表示具体需要操作的行数范围，{commnad} 表示对应的操作，而 {options} 则由 {command} 决定。

以复制操作为例，其语法为：

- `:{range}y {register}`

可以看到，对于复制操作 `y` 来说，对应的 {options} 就是复制操作对应的寄存器 {register}。例如，`:2,11y a` 表示将 2 到 11 行的内容复制到寄存器 a 中。

可以看到，上述例子中 {range} 对应的是 `2,11`，表示 2 到 11 行，除此之外，{range} 还有如下几种不同的形式。

- `{start},{offset}`: 表示第 {start} 行到第 {start} + {offset} 行，例如 `2,+9` 表示 2 到 11 行

- `{line}`: 表示第 {line} 行，例如 `11` 表示第 11 行。

- `.`: 表示当前行，例如 `.,-2` 表示当前行到上 2 行

- `%`: 表示当前文件所有内容

- `0`: 表示当前文件的开头，例如 `0,11` 表示文件开头到第 11 行

- `$`: 表示当前文件的结尾，例如 `.,$`: 表示当前行到文件结尾

- `'<,'>`: 在 Visual mode 下选中想要的内容，接着按下 `:`，会进入 Command-line mode，并将选择的内容作为 range，在下方的状态栏中会显示 `'<,'>`。

- 不输入 {range}，表示当前行

## 重复命令

类似于使用 `.` 重复执行上一次操作，我们可以使用 `@:` 重复执行上一次命令，在重复执行一次后，也可以使用 `@@` 再次重复执行。

## 替换操作

之前介绍了可以结合 `/` 搜索与 `.` 重复修改操作完成批量替换，在 Command-line mode 中，提供了 `s` 命令完成替换操作，其语法为：

- `:{range}s/{pattern}/{substitute}/{flags}`

{range} 与之前相同，{pattern} 表示想要替换的文字，支持正则，{substitute} 表示用于替换的文字，{flags} 表示一些标志。

例如，`:s/Kyrie/890514` 表示将当前行的第一个 `Kyrie` 替换成 `890514`，`:s/Kyrie/890514/g` 表示将当前行所有 `Kyrie` 替换成 `890514`，`:%s/Kyrie/890514` 表示将当前文件所有行的第一个 `Kyrie` 替换成 `890514`，`:%s/Kyrie/890514/g` 表示将当前文件所有 `Kyrie` 替换成 `890514`。

可以看到标志位 `g` 表示替换当前行所有符合的内容，除此之外，常用的标志还有 `i` 和 `c`。

- `i`: 大小写不敏感

- `c`: 每次替换都需要确认
