---
outline: deep
---

# 宏操作

通过之前的学习，我们知道可以使用 `.` 重复上一个操作，使用 `;` 和 `,` 重复上一次单字符搜索，使用 `n` 和 `N` 重复上一次搜索，使用 `@:` 和 `@@` 重复执行上一个命令(Command-line mode)；而在本章，我们将会学习如何录制一系列的操作并回放(重新执行一遍这些操作)，这个功能叫做宏操作。

## 语法

首先是录制操作的流程：

1. `q{register}`: 开始录制并存入寄存器 {register}，{register} 可以是 a-z 中的一个字母。例如，`qq` 会将录制的内容存入寄存器 q 中。注意，开始录制后，下方状态栏的左侧会出现类似 `Recording @q` 的标志。

2. 执行一些需要被录制的操作

3. `q`: 结束录制，此时下方状态栏左侧的 `Recording @q` 标志消失。

录制完成后，我们就可以回放(replay)它，即重新执行一遍录制的操作。

- `@{register}`: 执行存于寄存器 {register} 的操作，例如 `@q` 会执行刚刚使用 `qq` 录制的操作

与重复执行 Command-line mode 的命令一样，在执行一次后，可以使用 `@@` 再次执行。

当然我们也可以通过 `{count}@{register}` 和 `{count}@@` 这样的语法进行多次回放。

录制的宏操作会存入寄存器中，因此我们可以通过 `:reg` 或 `:reg {register}` 命令查看。

## 追加

我们可以使用 `q{REGISTER}` 在之前录制的操作后面追加操作，这里的 {REGISTER} 可以是 A-Z 中的一个字母。

例如，我们使用 `qq` 将操作 `dd` 录制到了寄存器 `q` 中，这是我们可以使用 `qQ` 向寄存器 `q` 追加操作，例如添加 `j` 操作，这样之后使用 `@q` 回放的操作就变为了 `ddj`。

## 修改

我们可以使用 `"{register}y{motion}` 将想要的内容复制并存入自定义寄存器，使用时通过 `"{register}p` 取出并粘贴。由于宏操作录制的操作也会存到寄存器中，因此我们也可以使用相似的方法修改录制的操作。

例如，我们使用 `qq` 录制了 `dd` 操作，我们可以使用 `"qp` 将存于寄存器 `q` 的内容 `dd` 粘贴出来，接着用 `Aj<Esc>` 将其修改为 `ddj`，接着使用 `"qyiw` 在将它存回去，这样就完成对宏操作的修改，之后使用 `@q` 回放的操作就变为了 `ddj`。
